<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="pneu-forte-colors.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aferir Veículos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="tailwind.config.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        @media (min-width: 768px) {
            #sidebar { transition: width 300ms ease; }
            #main-content { transition: margin-left 300ms ease; }
            body { overflow-x: hidden; }
            #sidebar nav a { position: relative; overflow: hidden; min-height: 44px; }
            #sidebar nav a i { display: inline-flex; align-items: center; justify-content: center; width: 1.25rem; flex: 0 0 1.25rem; line-height: 1; }
            #sidebar .pf-sidebar-label { display: inline-block; overflow: hidden; white-space: nowrap; max-width: 999px; opacity: 1; transform: translateX(0); transition: max-width 300ms ease, opacity 200ms ease, transform 200ms ease; }
            #sidebar .pf-sidebar-section-title { overflow: hidden; max-height: 2rem; opacity: 1; transform: translateY(0); transition: max-height 300ms ease, opacity 200ms ease, transform 200ms ease; }
            #sidebar .pf-sidebar-footer { overflow: hidden; max-height: 120px; opacity: 1; transform: translateY(0); transition: max-height 300ms ease, opacity 200ms ease, transform 200ms ease; }
            body:not(.pf-tablet-sidebar-expanded) #sidebar .pf-sidebar-label { max-width: 0; opacity: 0; transform: translateX(-6px); }
            body:not(.pf-tablet-sidebar-expanded) #sidebar .pf-sidebar-section-title { max-height: 0; opacity: 0; transform: translateY(-6px); }
            body:not(.pf-tablet-sidebar-expanded) #sidebar .pf-sidebar-footer { max-height: 0; opacity: 0; transform: translateY(8px); }
            body.pf-tablet-sidebar-expanded #sidebar { width: 20rem !important; /* w-80 */ }
            body:not(.pf-tablet-sidebar-expanded) #sidebar { width: 5rem !important; /* w-20 */ }
            #main-content { margin-left: 5rem !important; /* w-20 */ }
            body.pf-tablet-sidebar-expanded #main-content { margin-left: 20rem !important; /* w-80 */ }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

<header id="header" class="bg-white border-b border-gray-200 fixed top-0 left-0 right-0 z-50 bg-gradient-to-br from-azul-02 to-preto-90 h-[61px]">
    <div class="flex items-center justify-between px-3 sm:px-4 md:px-6 h-full">
        <div class="flex items-center space-x-4">
            <button id="sidebar-toggle" class="text-white text-xl md:hidden focus:outline-none">
                <i class="fa-solid fa-bars"></i>
            </button>
            <img src="PNEU-FORTE-2.png" alt="Pneu Forte Logo" class="h-10">
            <h1 class="text-xl md:text-2xl font-bold text-white hidden sm:block">Sistema de Aferição de Pneus</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div class="relative hidden lg:block">
                <input type="text" placeholder="Buscar aferições..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm w-64 lg:w-80 focus:outline-none focus:ring-2 focus:ring-azul-02 focus:border-transparent">
                <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            <button class="relative p-2 text-white hover:text-gray-300">
                <i class="fa-regular fa-bell text-xl"></i>
                <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
            </button>
            <div class="flex items-center space-x-3">
                <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg" alt="User" class="w-9 h-9 rounded-full">
                <div class="text-right hidden sm:block">
                    <p class="text-sm font-medium text-white">Carlos Silva</p>
                    <p class="text-xs text-white">Analista</p>
                </div>
                <i class="fa-solid fa-chevron-down text-white text-xs hidden sm:block"></i>
            </div>
        </div>
    </div>
</header>

<div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden opacity-0 transition-opacity duration-300 md:hidden"></div>

<aside id="sidebar" class="fixed left-0 top-[61px] h-[calc(100vh-61px)] w-64 md:w-20 bg-white border-r border-gray-200 flex flex-col transition-transform duration-300 -translate-x-full md:translate-x-0 z-40">
    <nav class="p-4 flex-1 overflow-y-auto">
        <!-- Tablet toggle (somente md..lg) -->
        <div class="pf-tablet-toggle-wrap hidden md:flex justify-end mb-3">
            <button id="tablet-sidebar-toggle" type="button" class="h-9 w-9 inline-flex items-center justify-center rounded-lg text-gray-600 hover:bg-gray-100" aria-label="Expandir/Recolher menu">
                <i class="fa-solid fa-angles-right"></i>
            </button>
        </div>
        <div class="space-y-1">
            <a href="dashboard-frota.html" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg">
                <i class="fa-solid fa-chart-line mr-3 text-base text-gray-500"></i>
                <span class="pf-sidebar-label">Dashboard de Aferição</span>
            </a>
            <a href="nova-solicitacao-frota.html" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg">
                <i class="fa-solid fa-plus-circle mr-3 text-base text-gray-500"></i>
                <span class="pf-sidebar-label">Nova Aferição</span>
            </a>
            <a href="solicitacoes-frota.html" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg">
                <i class="fa-solid fa-list mr-3 text-base text-gray-500"></i>
                <span class="pf-sidebar-label">Histórico de Aferições</span>
            </a>
                  <a href="aferir.html"
                    class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 bg-azul-02 rounded-lg">
                    <i class="fa-solid  fa-compact-disc mr-3 text-white"></i>
                    <span class="pf-sidebar-label text-white">Solicitação de aferimento</span>
                </a>
            <a href="relatorios-frota.html" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg">
                <i class="fa-solid fa-file-chart-column mr-3 text-base text-gray-500"></i>
                <span class="pf-sidebar-label">Relatórios</span>
            </a>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-200">
            <p class="pf-sidebar-section-title px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Cadastros</p>
            <div class="space-y-1">
                <a href="clientes-frota.html" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg">
                    <i class="fa-solid fa-users mr-3 text-gray-500"></i>
                    <span class="pf-sidebar-label">Clientes</span>
                </a>
                <a href="caminhoes.html" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg">
                    <i class="fa-solid fa-truck mr-3 text-gray-500"></i>
                    <span class="pf-sidebar-label">Veículos</span>
                </a>
                <a href="motoristas.html" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg">
                    <i class="fa-solid fa-id-card mr-3 text-gray-500"></i>
                    <span class="pf-sidebar-label">Motoristas</span>
                </a>
                <a href="marcas_frota.html" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg">
                    <i class="fa-solid fa-copyright mr-3 text-gray-500"></i>
                    <span class="pf-sidebar-label">Marcas de Pneu</span>
                </a>
                <a href="modelos_frota.html" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg">
                    <i class="fa-solid fa-car mr-3 text-gray-500"></i>
                    <span class="pf-sidebar-label">Modelos de Pneu</span>
                </a>
            </div>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-200">
            <p class="pf-sidebar-section-title px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Administração</p>
            <div class="space-y-1">
                <a href="usuarios-frota.html" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg">
                    <i class="fa-solid fa-users mr-3 text-gray-500"></i>
                    <span class="pf-sidebar-label">Usuários</span>
                </a>
                <a href="#" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg">
                    <i class="fa-solid fa-gear mr-3 text-gray-500"></i>
                    <span class="pf-sidebar-label">Configurações</span>
                </a>
                <a href="selecao-modulo.html" class="flex items-center px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 rounded-lg mt-4">
                    <i class="fa-solid fa-arrow-left mr-3"></i>
                    <span class="pf-sidebar-label">Trocar Módulo</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="pf-sidebar-footer shrink-0 p-4 bg-gradient-to-r from-primary-700 to-primary-800 m-4 rounded-lg">
        <div class="flex items-center justify-between text-white">
            <div>
                <p class="text-xs font-medium opacity-90">Parceiro</p>
                <p class="text-sm font-bold">Grupo Vipal</p>
            </div>
            <i class="fa-solid fa-handshake text-2xl opacity-80"></i>
        </div>
    </div>
</aside>

<main id="main-content" class="ml-0 md:ml-20 lg:ml-64 mt-[61px] p-3 sm:p-6 transition-all duration-300">
    <div class="mb-6 flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4 md:gap-6">
        <div>
            <h2 class="text-2xl font-bold text-gray-800">Painel de Aferição</h2>
            <p class="text-sm text-gray-600 mt-1">Gerencie as aferições diárias da frota.</p>
        </div>
        <div class="flex items-center gap-3">
             <button onclick="openNewMeasurementModal()" class="bg-azul-02 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-azul-04 transition-colors shadow-sm flex items-center">
                <i class="fa-solid fa-plus mr-2"></i> Nova Aferição
            </button>
        </div>
    </div>

    <!-- Dashboard Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Veículos Hoje</p>
                <p id="stat-total" class="text-2xl font-bold text-gray-800 mt-1">-</p>
            </div>
            <div class="bg-blue-50 p-3 rounded-full text-azul-02">
                <i class="fa-solid fa-truck-fast text-xl"></i>
            </div>
        </div>
        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Pendentes</p>
                <p id="stat-pending" class="text-2xl font-bold text-orange-500 mt-1">-</p>
            </div>
            <div class="bg-orange-50 p-3 rounded-full text-orange-500">
                <i class="fa-regular fa-clock text-xl"></i>
            </div>
        </div>
        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Concluídos</p>
                <p id="stat-completed" class="text-2xl font-bold text-green-600 mt-1">-</p>
            </div>
            <div class="bg-green-50 p-3 rounded-full text-green-600">
                <i class="fa-solid fa-check-double text-xl"></i>
            </div>
        </div>
    </div>

    <div id="filter-section" class="bg-white rounded-lg border border-gray-200 p-4 mb-6 shadow-sm">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div class="flex flex-col sm:flex-row sm:items-center gap-3 flex-1">
                <div class="relative flex-1 sm:max-w-md">
                    <input type="text" id="searchInput" placeholder="Buscar placa, modelo..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm w-full focus:outline-none focus:ring-2 focus:ring-azul-02">
                    <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-azul-02 bg-white">
                    <option value="">Todos os Status</option>
                    <option value="ok">Ok</option>
                    <option value="attention">Atenção</option>
                    <option value="problem">Com Problema</option>
                </select>
            </div>
        </div>
    </div>

    <div id="trucks-table-section" class="bg-white rounded-lg border border-gray-200">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50 border-b border-gray-200">
                    <tr>
                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Veículo</th>
                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Modelo / Config</th>
                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Pneus</th>
                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Última Aferição</th>
                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Ações</th>
                    </tr>
                </thead>
                <tbody id="vehiclesTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Loaded via JS -->
                </tbody>
            </table>
        </div>
        <div id="empty-state" class="hidden p-8 text-center text-gray-500">
            Nenhum veículo encontrado.
        </div>
    </div>

    <!-- New Measurement Modal -->
    <div id="new-measurement-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                    <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                                <i class="fa-solid fa-truck-medical text-azul-02"></i>
                            </div>
                            <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
                                <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Nova Aferição</h3>
                                <div class="mt-2">
                                    <p class="text-sm text-gray-500 mb-4">Selecione um veículo para iniciar uma nova aferição.</p>
                                    
                                    <label for="modal-vehicle-select" class="block text-sm font-medium text-gray-700 mb-1">Veículo</label>
                                    <select id="modal-vehicle-select" class="w-full rounded-md border border-gray-300 py-2 pl-3 pr-10 text-base focus:border-azul-02 focus:outline-none focus:ring-azul-02 sm:text-sm">
                                        <option value="">Selecione um veículo...</option>
                                        <!-- Options populated via JS -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 gap-2">
                        <button type="button" onclick="startMeasurement()" class="inline-flex w-full justify-center rounded-md bg-azul-02 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-azul-04 sm:w-auto">Iniciar</button>
                        <button type="button" onclick="closeNewMeasurementModal()" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    const PF_VEHICLES_STORAGE_KEY = 'pf_prolog_prototipo_vehicles_v1';
    let vehiclesData = [];

    function loadVehiclesDataFromStorage() {
        try {
            const raw = localStorage.getItem(PF_VEHICLES_STORAGE_KEY);
            if (!raw) return [];
            const parsed = JSON.parse(raw);
            return Array.isArray(parsed) ? parsed : [];
        } catch (e) {
            return [];
        }
    }

    function updateDashboardStats() {
        const total = vehiclesData.length;
        // Simulação de status para o dashboard
        const completed = Math.floor(total * 0.65); 
        const pending = total - completed;

        document.getElementById('stat-total').textContent = total;
        document.getElementById('stat-pending').textContent = pending;
        document.getElementById('stat-completed').textContent = completed;
    }

    function renderTable() {
        const tbody = document.getElementById('vehiclesTableBody');
        const emptyState = document.getElementById('empty-state');
        const searchQ = document.getElementById('searchInput').value.toLowerCase();
        
        tbody.innerHTML = '';
        
        const filtered = vehiclesData.filter(v => {
            const matchSearch = (v.placa || '').toLowerCase().includes(searchQ) || 
                                (v.modelo || '').toLowerCase().includes(searchQ);
            return matchSearch;
        });

        if (filtered.length === 0) {
            emptyState.classList.remove('hidden');
            return;
        }
        emptyState.classList.add('hidden');

        filtered.forEach(v => {
            const tiresCount = v.tires ? v.tires.length : 0;
            const hasProblem = v.tires.some(t => t.status === 'remove' || t.status === 'attention') || 
                               Object.values(v.vehicleSafetyChecklist?.items || {}).some(i => i.status === 'problem');
            
            const statusBadge = hasProblem 
                ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Atenção</span>'
                : '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Ok</span>';

            const statusColorClass = hasProblem ? 'border-l-4 border-l-red-500' : 'border-l-4 border-l-green-500';
            
            const tr = document.createElement('tr');
            tr.className = `hover:bg-gray-50 transition-colors ${statusColorClass}`;
            tr.innerHTML = `
                <td class="px-3 sm:px-6 py-4 text-sm font-medium text-gray-800">
                    <div class="flex items-center">
                        <span class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3 text-azul-02 shrink-0">
                            <i class="fa-solid fa-truck"></i>
                        </span>
                        <div>
                            <div class="font-bold text-gray-900">${v.placa}</div>
                            <div class="text-xs text-gray-500 mt-0.5">Frota: ${v.frota || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-3 sm:px-6 py-4 text-sm text-gray-700">
                    <p class="font-medium">${v.modelo || '-'}</p>
                    <p class="text-xs text-gray-500">${v.config || '-'}</p>
                </td>
                <td class="px-3 sm:px-6 py-4 text-sm text-gray-700">
                    <div class="flex items-center gap-2">
                        <i class="fa-solid fa-circle-dot text-gray-400 text-xs"></i>
                        <span>${tiresCount} pneus</span>
                    </div>
                </td>
                <td class="px-3 sm:px-6 py-4 text-sm text-gray-700">
                    <div class="flex flex-col">
                        <span class="font-medium">Hoje</span>
                        ${statusBadge}
                    </div>
                </td>
                <td class="px-3 sm:px-6 py-4 text-sm whitespace-nowrap text-right">
                    <div class="flex items-center justify-end gap-2">
                        <a href="realizar-afericao.html?id=${v.id}" class="inline-flex items-center px-3 py-1.5 bg-azul-02 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-azul-04 transition-colors shadow-sm">
                            <i class="fa-solid fa-clipboard-check mr-1.5"></i>
                            Aferir
                        </a>
                        <button class="p-2 text-gray-400 hover:text-azul-02 hover:bg-blue-50 rounded-lg transition-colors" title="Ver Histórico">
                            <i class="fa-solid fa-clock-rotate-left"></i>
                        </button>
                        <button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" title="Mais Opções">
                            <i class="fa-solid fa-ellipsis-vertical"></i>
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function openNewMeasurementModal() {
        const modal = document.getElementById('new-measurement-modal');
        const select = document.getElementById('modal-vehicle-select');
        
        // Populate select
        select.innerHTML = '<option value="">Selecione um veículo...</option>';
        vehiclesData.forEach(v => {
            const option = document.createElement('option');
            option.value = v.id;
            option.textContent = `${v.placa} - ${v.modelo}`;
            select.appendChild(option);
        });

        modal.classList.remove('hidden');
    }

    function closeNewMeasurementModal() {
        document.getElementById('new-measurement-modal').classList.add('hidden');
    }

    function startMeasurement() {
        const select = document.getElementById('modal-vehicle-select');
        const vehicleId = select.value;
        
        if (!vehicleId) {
            alert('Por favor, selecione um veículo.');
            return;
        }
        
        window.location.href = `realizar-afericao.html?id=${vehicleId}`;
    }

    document.addEventListener('DOMContentLoaded', () => {
        vehiclesData = loadVehiclesDataFromStorage();
        
        // Mock data if empty for demo purposes
        if (vehiclesData.length === 0) {
            const positions6x2 = ['1E', '1D', '2EE', '2EI', '2DI', '2DD', '3EE', '3EI', '3DI', '3DD'];
            const createTires = (status) => positions6x2.map(pos => ({
                pos, status, brand: 'michelin', psi: 110, mm: 12, obs: ''
            }));

            vehiclesData = [
                { id: 1, placa: 'ABC-1234', frota: '001', modelo: 'Volvo FH 540', config: '6x2', tires: createTires('ok') },
                { id: 2, placa: 'XYZ-9876', frota: '002', modelo: 'Scania R450', config: '6x2', tires: createTires('attention') },
                { id: 3, placa: 'DEF-5678', frota: '003', modelo: 'Mercedes Actros', config: '6x2', tires: createTires('ok') },
            ];
            // Persist so other pages can see it
            localStorage.setItem(PF_VEHICLES_STORAGE_KEY, JSON.stringify(vehiclesData));
        }

        renderTable();
        updateDashboardStats();

        document.getElementById('searchInput').addEventListener('input', renderTable);
        
        // Sidebar logic
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const btnToggle = document.getElementById('sidebar-toggle');
        const tabletToggle = document.getElementById('tablet-sidebar-toggle');

        function toggleSidebar() {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        if(btnToggle) btnToggle.addEventListener('click', toggleSidebar);
        if(overlay) overlay.addEventListener('click', toggleSidebar);
        
        if(tabletToggle) {
            tabletToggle.addEventListener('click', () => {
                document.body.classList.toggle('pf-tablet-sidebar-expanded');
                const expanded = document.body.classList.contains('pf-tablet-sidebar-expanded');
                tabletToggle.innerHTML = expanded ? '<i class="fa-solid fa-angles-left"></i>' : '<i class="fa-solid fa-angles-right"></i>';
            });
        }
        
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.add('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        });
    });
</script>
</body>
</html>