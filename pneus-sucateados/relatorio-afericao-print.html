<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Inspeção de Frota</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="pneu-forte-colors.css">
    <script src="tailwind.config.js"></script>
    <style>
        @media print {
            .no-print {
                display: none !important;
            }

            .page-break {
                page-break-before: always;
            }

            body {
                background: white;
                -webkit-print-color-adjust: exact;
            }

            #report-container {
                box-shadow: none;
                margin: 0;
                width: 100%;
            }

            .report-page {
                margin: 0;
                page-break-after: always;
                height: auto;
                min-height: 297mm;
            }
        }

        .report-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 20mm;
            margin: 0 auto;
            position: relative;
            display: flex;
            flex-direction: column;
            margin-bottom: 2rem;
        }

        .tire-box {
            width: 80px;
            padding: 4px;
            text-align: center;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            background-color: #f9fafb;
        }

        .tire-value {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .tire-psi {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .axle-line {
            height: 4px;
            background-color: #d1d5db;
            width: 100%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 0;
        }

        /* Extra breathing room for the smallest PSI boxes */
        .report-page div[class*="text-[10px]"][class*="border-2"][class*="border-black"] {
            padding-top: 0.35rem !important;
            padding-bottom: 0.35rem !important;
            padding-left: 0.35rem !important;
            padding-right: 0.35rem !important;
            line-height: 1.1;
        }

        /* Standard padding for all PSI boxes (helps red ones too) */
        .report-page div[class*="border-2"][class*="border-black"][class*="rounded"][class*="shadow-sm"][class*="text-center"] {
            padding-left: 0.35rem;
            padding-right: 0.35rem;
        }

        /* mm callouts are repositioned via JS to avoid overlap */
    </style>
</head>

<body class="bg-gray-200 font-sans">

    <!-- Controls -->
    <div class="fixed top-4 left-4 z-50 no-print">
        <a href="frota-analise-detalhe.html"
            class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 flex items-center shadow-md transition-colors">
            <i class="fa-solid fa-arrow-left mr-2"></i>
            Voltar
        </a>
    </div>

    <div class="fixed top-4 right-4 z-50 no-print">
        <button onclick="window.print()"
            class="px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center font-medium shadow-md transition-colors">
            <i class="fa-solid fa-print mr-2"></i>
            Imprimir / Salvar PDF
        </button>
    </div>

    <div id="report-container" class="mx-auto my-8">

        <!-- Page 1: Cover / Intro -->
        <div class="report-page shadow-lg flex flex-col">
            <header class="flex justify-between items-start mb-16">
                <div>
                    <h2 class="text-lg font-bold">Cliente teste</h2>
                    <p class="text-sm">Sr. X</p>
                </div>
                <div class="text-right">
                    <img src="pneu-forte-logo.jpeg" alt="Pneu Forte Logo" class="vipal-logo ml-auto">
                    <p class="text-sm mt-2">27/01/2026</p>
                </div>
            </header>

            <main class="flex-grow flex flex-col justify-center items-center">
                <h1 class="text-2xl font-bold mb-12">RELATÓRIO DE AFERIÇÃO</h1>
                <div class="text-sm text-gray-700 max-w-3xl space-y-4 text-justify">
                    <p><strong>Caro Cliente,</strong></p>
                    <p>O Programa de Orientação ao Transportador (Protrans) é um conjunto de serviços exclusivos da
                        Vipal para aprimorar o desempenho da sua frota. Por meio de visitas, palestras, treinamentos e
                        implantação de softwares de gerenciamento, nossos consultores ajudam você e sua equipe a rodar
                        com muito mais economia e segurança.</p>
                    <p>O relatório que você verá a seguir apresenta os dados avaliados na <strong>AFERIÇÃO DE
                            PNEUS</strong>, seguidos de orientação técnica recomendada por nossa equipe. Tudo isto para
                        você obter ótimos resultados de seus pneus.</p>
                    <p>Para que este trabalho tenha sucesso, é fundamental o envolvimento e comprometimento da sua
                        empresa em todas as suas etapas. Nossa equipe de consultores de negócios e o seu Reformador
                        Autorizado Vipal encontram-se a disposição para a plena realização deste projeto e elaboração de
                        Plano de Ação das melhorias.</p>
                </div>
            </main>

            <footer class="pt-16 mt-auto">
                <div class="flex items-end justify-between">
                    <div class="w-64">
                        <p class="border-t border-black pt-2 font-bold text-gray-800">Welington Pires do Nascimento</p>
                        <p class="text-xs text-gray-600">Consultor de Frotas</p>
                        <p class="text-xs font-bold mt-1 text-gray-800">Vipal Borrachas</p>
                    </div>
                    <div class="text-right text-xs text-gray-500 mb-4">1/8</div>
                </div>
            </footer>
        </div>

        <!-- Page 2: Detailed Analysis and Charts -->
        <div class="report-page shadow-lg">
            <header class="flex justify-between items-center mb-6 border-b pb-4">
                <div class="flex items-center gap-4">
                    <div class="bg-gray-100 p-3 rounded-lg border border-gray-200">
                        <i class="fa-solid fa-truck text-2xl text-gray-600"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">Veículo: 78191</h1>
                        <div class="flex items-center gap-2 text-sm text-gray-600 mt-1">
                            <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded font-medium text-xs">Truck 6x2</span>
                            <span>•</span>
                            <span>Frota Principal</span>
                        </div>
                    </div>
                </div>
                <img src="pneu-forte-logo.jpeg" alt="Logo" class="vipal-logo">
            </header>

            <main class="flex-grow">
                
                <!-- Detailed Tire List -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-1 inline-block border-gray-800">Relação de Pneus - Histórico Completo</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-xs border-collapse border border-gray-300 shadow-sm">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th class="border border-gray-300 p-2 text-center">Pos</th>
                                    <th class="border border-gray-300 p-2 text-left">Marca/Modelo</th>
                                    <th class="border border-gray-300 p-2 text-center bg-gray-100">
                                        27/10/25<br><span class="text-[10px] font-normal">PSI / mm</span>
                                    </th>
                                    <th class="border border-gray-300 p-2 text-center">
                                        27/11/25<br><span class="text-[10px] font-normal">PSI / mm</span>
                                    </th>
                                    <th class="border border-gray-300 p-2 text-center bg-gray-100">
                                        27/12/25<br><span class="text-[10px] font-normal">PSI / mm</span>
                                    </th>
                                    <th class="border border-gray-300 p-2 text-center font-bold">
                                        27/01/26<br><span class="text-[10px] font-normal">PSI / mm</span>
                                    </th>
                                    <th class="border border-gray-300 p-2 text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white">
                                <!-- Axle 1 -->
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">1E</td>
                                    <td class="border border-gray-300 p-2">Michelin</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">108 / 11.5</td>
                                    <td class="border border-gray-300 p-2 text-center">112 / 11.4</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">109 / 11.2</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">113 / 11.0</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-green-600 font-bold">Ok</span></td>
                                </tr>
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">1D</td>
                                    <td class="border border-gray-300 p-2">Michelin</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">111 / 11.5</td>
                                    <td class="border border-gray-300 p-2 text-center">109 / 11.4</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">114 / 11.2</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">112 / 11.0</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-green-600 font-bold">Ok</span></td>
                                </tr>
                                <!-- Axle 2 -->
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">2EE</td>
                                    <td class="border border-gray-300 p-2">Bridgestone</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">106 / 6.5</td>
                                    <td class="border border-gray-300 p-2 text-center">111 / 6.2</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">107 / 6.0</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">108 / 5.8</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-yellow-600 font-bold">Atenção</span></td>
                                </tr>
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">2EI</td>
                                    <td class="border border-gray-300 p-2">Bridgestone</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">109 / 6.5</td>
                                    <td class="border border-gray-300 p-2 text-center">105 / 6.2</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">112 / 6.0</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold text-gray-400">-</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-red-600 font-bold text-[10px]">Sem Acesso</span></td>
                                </tr>
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">2DI</td>
                                    <td class="border border-gray-300 p-2">Goodyear</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">112 / 5.0</td>
                                    <td class="border border-gray-300 p-2 text-center">107 / 4.8</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">110 / 4.5</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold text-gray-400">-</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-red-600 font-bold text-[10px]">Sem Acesso</span></td>
                                </tr>
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">2DD</td>
                                    <td class="border border-gray-300 p-2">Goodyear</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">113 / 4.8</td>
                                    <td class="border border-gray-300 p-2 text-center">108 / 4.6</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">104 / 4.4</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">106 / 4.2</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-yellow-600 font-bold">Atenção</span></td>
                                </tr>
                                <!-- Axle 3 -->
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">3EE</td>
                                    <td class="border border-gray-300 p-2">Pirelli</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">105 / 17.8</td>
                                    <td class="border border-gray-300 p-2 text-center">110 / 17.5</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">114 / 17.2</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">111 / 17.0</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-green-600 font-bold">Ok</span></td>
                                </tr>
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">3EI</td>
                                    <td class="border border-gray-300 p-2">Pirelli</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">108 / 18.2</td>
                                    <td class="border border-gray-300 p-2 text-center">113 / 18.0</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">109 / 17.7</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">114 / 17.5</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-green-600 font-bold">Ok</span></td>
                                </tr>
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">3DI</td>
                                    <td class="border border-gray-300 p-2">Continental</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">111 / 9.8</td>
                                    <td class="border border-gray-300 p-2 text-center">106 / 9.6</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">112 / 9.4</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">114 / 9.2</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-green-600 font-bold">Ok</span></td>
                                </tr>
                                <tr>
                                    <td class="border border-gray-300 p-2 text-center font-bold">3DD</td>
                                    <td class="border border-gray-300 p-2">Continental</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">107 / 10.2</td>
                                    <td class="border border-gray-300 p-2 text-center">115 / 10.0</td>
                                    <td class="border border-gray-300 p-2 text-center bg-gray-50">110 / 9.9</td>
                                    <td class="border border-gray-300 p-2 text-center font-bold">113 / 9.7</td>
                                    <td class="border border-gray-300 p-2 text-center"><span class="text-green-600 font-bold">Ok</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pressure Charts Stacked -->
                <div class="mb-8 space-y-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-1 inline-block border-gray-800">Evolução da Pressão por Pneu</h3>
                    
                    <!-- Chart 3: Line -->
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                        <div id="chart-line-pressure" class="w-full h-80"></div>
                    </div>
                </div>

                <div class="mt-8 mb-8">
                    <p class="text-gray-800">Atenciosamente,</p>
                    <p class="font-bold text-gray-800 mt-4">Welington Pires do Nascimento</p>
                    <p class="font-bold text-gray-600">Consultor de Frotas</p>
                </div>
            </main>

            <div class="mt-auto text-right text-xs text-gray-500 pt-4">8/8</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sizeRegex = /^text-(xs|sm|base|lg|xl|\d+xl|\[.*\])$/;

            const isInlineMmRow = (el) => {
                if (!(el instanceof HTMLElement)) return false;
                if (!el.classList.contains('flex') || !el.classList.contains('items-center')) return false;
                if (!el.classList.contains('w-max')) return false;

                const icon = el.querySelector(':scope > i.fa-flag');
                const span = el.querySelector(':scope > span');
                if (!icon || !span) return false;

                const txt = (span.textContent || '').trim();
                return txt.endsWith('mm');
            };

            const calloutSelectors = [
                'div[class*="absolute right-full mr-2 top-1/2 transform -translate-y-1/2"]',
                'div[class*="absolute left-full ml-2 top-1/2 transform -translate-y-1/2"]'
            ];

            calloutSelectors.forEach((selector) => {
                const callouts = Array.from(document.querySelectorAll(selector));

                callouts.forEach((callout) => {
                    const parent = callout.parentElement;
                    if (!parent) return;

                    callout.remove();

                    // Interleave: PSI box -> mm callout -> PSI box -> mm callout
                    // (keeps both values visible and avoids overlay)
                    callout.className = 'pf-mm-badge inline-flex items-center justify-center gap-1 w-max bg-white border border-gray-300 rounded px-1 py-0 shadow-sm text-[10px] leading-none -mt-1 -mb-1';

                    const span = callout.querySelector('span');
                    if (span) {
                        const classes = span.className.split(/\s+/).filter(Boolean);
                        span.className = classes.filter(c => !sizeRegex.test(c)).concat(['text-[10px]']).join(' ');
                    }

                    const icon = callout.querySelector('i');
                    if (icon) {
                        const classes = icon.className.split(/\s+/).filter(Boolean);
                        icon.className = classes.filter(c => !sizeRegex.test(c)).concat(['text-[10px]']).join(' ');
                    }

                    parent.insertAdjacentElement('afterend', callout);
                });
            });

            // Clean up: previous version could mistakenly style axle containers.
            const mistakenlyStyled = Array.from(document.querySelectorAll('div[class*="flex-col"][class*="bg-white"][class*="border-gray-300"][class*="shadow-sm"]'));
            mistakenlyStyled.forEach((el) => {
                el.classList.remove('bg-white', 'border', 'border-gray-300', 'rounded', 'px-1', 'py-0', 'shadow-sm');
            });

            // Front axle (and any other) mm rows that were already inline (not absolute callouts)
            // also get the same fixed background badge for readability.
            const mmRows = Array.from(document.querySelectorAll('div.flex.items-center.w-max'))
                .filter((row) => isInlineMmRow(row) && !row.classList.contains('pf-mm-badge'));

            mmRows.forEach((row) => {
                row.classList.add('pf-mm-badge', 'bg-white', 'border', 'border-gray-300', 'rounded', 'px-1', 'py-0', 'shadow-sm');

                const span = row.querySelector(':scope > span');
                if (span) {
                    const classes = span.className.split(/\s+/).filter(Boolean);
                    span.className = classes.filter(c => !sizeRegex.test(c)).concat(['text-[10px]']).join(' ');
                }

                const icon = row.querySelector(':scope > i');
                if (icon) {
                    const classes = icon.className.split(/\s+/).filter(Boolean);
                    icon.className = classes.filter(c => !sizeRegex.test(c)).concat(['text-[10px]']).join(' ');
                }
            });

            // Chart Initialization
            const chartLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { family: 'Inter, sans-serif' },
                margin: { t: 20, r: 20, b: 30, l: 40 },
                showlegend: true,
                legend: { orientation: 'h', y: -0.2 }
            };
            const config = { responsive: true, displayModeBar: false };

            // Data: Full Pressure History (Tire x Month)
            const months = ['Out/25', 'Nov/25', 'Dez/25', 'Jan/26'];
            const tiresData = [
                { name: '1E', data: [108, 112, 109, 113], color: '#16a34a' },
                { name: '1D', data: [111, 109, 114, 112], color: '#16a34a' },
                { name: '2EE', data: [106, 111, 107, 108], color: '#ca8a04' },
                { name: '2EI', data: [109, 105, 112, null], color: '#dc2626' },
                { name: '2DI', data: [112, 107, 110, null], color: '#dc2626' },
                { name: '2DD', data: [113, 108, 104, 106], color: '#ca8a04' },
                { name: '3EE', data: [105, 110, 114, 111], color: '#2563eb' },
                { name: '3EI', data: [108, 113, 109, 114], color: '#2563eb' },
                { name: '3DI', data: [111, 106, 112, 114], color: '#2563eb' },
                { name: '3DD', data: [107, 115, 110, 113], color: '#2563eb' }
            ];

            // Common Layout Settings
            const baseLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { family: 'Inter, sans-serif' },
                margin: { t: 30, r: 20, b: 60, l: 40 },
                showlegend: true,
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { title: 'Mês' },
                yaxis: { title: 'PSI', range: [100, 116] }
            };

            // Data for Pie/Donut: Latest Pressure (Jan/26) per Tire
            // Using index 3 of the data array which corresponds to Jan/26
            const latestPressures = tiresData.map(t => t.data[3] || 0); // 0 if null
            const tireLabels = tiresData.map(t => t.name);
            const tireColors = tiresData.map(t => t.color);

            // Chart 1: Bar Chart (Grouped) - Pressure x Time
            const barTraces = tiresData.map(tire => ({
                x: months,
                y: tire.data,
                name: tire.name,
                type: 'bar',
                marker: { color: tire.color }
            }));
            const barLayout = { ...baseLayout, barmode: 'group', margin: { t: 20, r: 20, b: 40, l: 40 } }; // No title
            if (document.getElementById('chart-bar-pressure')) {
                Plotly.newPlot('chart-bar-pressure', barTraces, barLayout, config);
            }

            // Chart 2: Pie Chart - Latest Pressure per Tire
            const pieData = [{
                labels: tireLabels,
                values: latestPressures,
                type: 'pie',
                marker: { colors: tireColors },
                textinfo: 'label+value',
                sort: false // Keep order consistent with other charts (1E, 1D...)
            }];
            const pieLayout = { 
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { family: 'Inter, sans-serif' },
                margin: { t: 20, r: 20, b: 20, l: 20 },
                showlegend: true,
                legend: { orientation: 'h', y: -0.1 }
            };
            if (document.getElementById('chart-pie-pressure')) {
                Plotly.newPlot('chart-pie-pressure', pieData, pieLayout, config);
            }

            // Chart 3: Line Chart (Standard) - Pressure x Time
            const lineTraces = tiresData.map(tire => ({
                x: months,
                y: tire.data,
                name: tire.name,
                type: 'scatter',
                mode: 'lines+markers',
                line: { width: 3, color: tire.color },
                marker: { size: 6 }
            }));
            const lineLayout = { ...baseLayout, margin: { t: 20, r: 20, b: 40, l: 40 } }; // No title
            if (document.getElementById('chart-line-pressure')) {
                Plotly.newPlot('chart-line-pressure', lineTraces, lineLayout, config);
            }

            // Chart 4: Donut Chart - Latest Pressure per Tire
            const donutData = [{
                labels: tireLabels,
                values: latestPressures,
                type: 'pie',
                marker: { colors: tireColors },
                textinfo: 'label+value',
                hole: 0.5,
                sort: false // Keep order consistent
            }];
            if (document.getElementById('chart-area-pressure')) {
                Plotly.newPlot('chart-area-pressure', donutData, pieLayout, config);
            }
        });
    </script>
</body>

</html>
